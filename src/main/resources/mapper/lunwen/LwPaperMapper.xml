<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.sgcc.bg.lunwen.mapper.LwPaperMapper">

    <!--新增论文信息-->
    <insert id="addLwPaper">
      insert into bg_lw_paper
        (UUID,
        PAPER_ID,
        PAPER_NAME,
        year,
        UNIT,
        AUTHOR,
        JOURNAL,
        RECOMMEND_UNIT,
        PAPER_TYPE,
        QUOTE_COUNT,
        DOWNLOAD_COUNT,
        FIELD,
        SCORE_TABLE_STATUS,
        SCORE_STATUS,
        ALL_STATUS,
        CREATE_USER,
        CREATE_TIME,
        VALID)
      VALUES
        (#{uuid,jdbcType=VARCHAR},
        #{paperId,jdbcType=VARCHAR},
        #{paperName,jdbcType=VARCHAR},
        #{year,jdbcType=VARCHAR},
        #{unit,jdbcType=VARCHAR},
        #{author,jdbcType=VARCHAR},
        #{journal,jdbcType=VARCHAR},
        #{recommendUnit,jdbcType=VARCHAR},
        #{paperType,jdbcType=VARCHAR},
        #{quoteCount,jdbcType=VARCHAR},
        #{downloadCount,jdbcType=VARCHAR},
        #{field,jdbcType=VARCHAR},
        #{scoreTableStatus,jdbcType=VARCHAR},
        #{scoreStatus,jdbcType=VARCHAR},
        #{allStatus,jdbcType=VARCHAR},
        #{createUser,jdbcType=VARCHAR},
        #{createTime,jdbcType=TIMESTAMP},
        #{valid}
        )
    </insert>

    <!--修改论文基本信息-->
    <update id="updateLwPaper">
        update bg_lw_paper set
        PAPER_NAME = #{paperName,jdbcType=VARCHAR},
        UNIT = #{unit,jdbcType=VARCHAR},
        AUTHOR = #{author,jdbcType=VARCHAR},
        JOURNAL = #{journal,jdbcType=VARCHAR},
        RECOMMEND_UNIT = #{recommendUnit,jdbcType=VARCHAR},
        PAPER_TYPE = #{paperType,jdbcType=VARCHAR},
        QUOTE_COUNT = #{quoteCount,jdbcType=VARCHAR},
        DOWNLOAD_COUNT = #{downloadCount,jdbcType=VARCHAR},
        FIELD = #{field,jdbcType=VARCHAR},
        UPDATE_USER = #{updateUser,jdbcType=VARCHAR},
        UPDATE_TIME = sysdate
        where UUID = #{uuid}
    </update>

    <!--修改生成打分表状态-->
    <update id="updateScoreTableStatus">
        update bg_lw_paper
        set  SCORE_TABLE_STATUS  = #{scoreTableStatus}
        where UUID  = #{uuid}
    </update>

    <!--修改打分状态-->
    <update id="updateScoreStatus">
        update bg_lw_paper
        set  SCORE_STATUS  = #{scoreStatus}
        where UUID  = #{uuid}
    </update>

    <!--修改论文全生命周期状态-->
    <update id="updateAllStatus">
        update bg_lw_paper
        set  ALL_STATUS  = #{allStatus}
        where UUID  = #{uuid}
    </update>

    <!--删除某条论文，逻辑删除，单纯修改有效状态-->
    <update id="delLwPaper">
        update bg_lw_paper
        set  VALID  = #{valid}
        where UUID  = #{uuid}
    </update>

    <!--查找某条论文-->
    <select id="findPaper" resultType="java.util.Map">
       select  p.uuid               uuid,
               p.paper_id           paperId,
               p.paper_name         paperName,
               p.year,
               p.unit,
               p.author,
               p.journal,
               p.recommend_unit     recommendUnit,
               p.paper_type         paperType,
               p.quote_count        quoteCount,
               p.download_count     downloadCount,
               p.field,
               p.score_status  as scoreStatus,
               p.score_table_status  as scoreTableStatus,
               p.all_status  as allStatus,
               (SELECT name FROM BG_SYS_DATADICTIONARY  WHERE pcode='score_status' and vaild=1 and code= p.score_status)  as scoreStatusDetail,
               (SELECT name FROM BG_SYS_DATADICTIONARY  WHERE pcode='score_table_status' and vaild=1 and code= p.score_table_status)  as scoreTableStatusDetail,
               (SELECT name FROM BG_SYS_DATADICTIONARY  WHERE pcode='paper_all_status' and vaild=1 and code= p.all_status)  as allStatusDetail,
               p.create_user        createUser,
               p.update_user        updateUser,
               TO_CHAR(p.create_time, 'YYYY-MM-DD HH24:MI')    createTime,
               TO_CHAR(p.update_time, 'YYYY-MM-DD HH24:MI')    updateTime,
               p.valid
       from bg_lw_paper p
       where 1=1
       <if test="uuid != null and uuid != ''">
          and p.uuid = #{uuid}
       </if>
       <if test="paperName != null and paperName != ''">
          and p.paper_name = #{paperName}
       </if>
       <if test="valid !=null and valid != ''">
          and p.valid = #{valid}
       </if>
    </select>

    <!--按条件查询某批论文信息-->
    <select id="selectLwPaper" resultType="java.util.Map">
        select *
        from (select p.uuid,
            p.paper_id paperId,
            p.paper_name paperName,
            p.year,
            p.unit,
            p.author,
            p.journal,
            p.recommend_unit recommendUnit,
            p.paper_type paperType,
            p.quote_count quoteCount,
            p.download_count downloadCount,
            p.field,
            p.score_table_status scoreTableStatus,
            (SELECT name FROM BG_SYS_DATADICTIONARY  WHERE pcode='score_status' and vaild=1 and code= p.score_status)  as scoreStatus,
            p.all_status allStatus,
            p.create_user createUser,
            p.update_user updateUser,
            TO_CHAR(p.create_time, 'YYYY-MM-DD HH24:MI') createTime,
            TO_CHAR(p.update_time, 'YYYY-MM-DD HH24:MI') updateTime,
            p.valid,
            ROWNUM rown
            from bg_lw_paper p
            where 1 = 1
            <if test="paperName != null and paperName != ''">
              and p.paper_name = #{paperName}
            </if>
            <if test="year != null and year != ''">
              and p.year = #{year}
            </if>
            <if test="paperId != null and paperId != ''">
              and p.paper_id = #{paperId}
            </if>
            <if test="unit != null and unit != ''">
              and p.unit = #{unit}
            </if>
            <if test="author != null and author != ''">
              and p.author = #{author}
            </if>
            <if test="field != null and field != ''">
              and p.field = #{field}
            </if>
            <if test="scoreStatus != null and scoreStatus != ''">
                and p.score_status = #{scoreStatus}
            </if>
            <if test="paperType != null and paperType != ''">
                and p.paper_type = #{paperType}
            </if>
            and valid = #{valid}
        AND #{pageEnd} >= ROWNUM
        ) p WHERE p.rown > #{pageStart}
    </select>

    <!--按条件查询某批论文信息总数，为上面那条sql提供总数，以便分页，total-->
    <select id="selectLwPaperCount" resultType="java.lang.Integer">
        select count(*)
        from bg_lw_paper p
        where 1 = 1
        <if test="paperName != null and paperName != ''">
            and p.paper_name = #{paperName}
        </if>
        <if test="year != null and year != ''">
            and p.year = #{year}
        </if>
        <if test="paperId != null and paperId != ''">
            and p.paper_id = #{paperId}
        </if>
        <if test="unit != null and unit != ''">
            and p.unit = #{unit}
        </if>
        <if test="author != null and author != ''">
            and p.author = #{author}
        </if>
        <if test="field != null and field != ''">
            and p.field = #{field}
        </if>
        <if test="scoreStatus != null and scoreStatus != ''">
            and p.score_status = #{scoreStatus}
        </if>
        <if test="paperType != null and paperType != ''">
            and p.paper_type = #{paperType}
        </if>
        and p.valid = #{valid}
    </select>

</mapper>